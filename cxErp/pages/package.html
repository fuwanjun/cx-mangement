<!DOCTYPE html>

<html>

<head>
	<title></title>
	<meta charset='utf-8'>
	<meta name='renderer' content='webkit'>
	<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
	<meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1'>
	<meta name='apple-mobile-web-app-status-bar-style' content='black'>
	<meta name='apple-mobile-web-app-capable' content='yes'>
	<meta name='format-detection' content='telephone=no'>
	<link rel="stylesheet" href="../resource/layui/css/layui.css">
	<link rel="stylesheet" type="text/css" href='css/pageIndex.css' />
	<link rel="stylesheet" type="text/css" href='css/orderManagement.css' />
	<style>
		.goodsImg{
			width: 50px;
			height: 50px;
		}
		body{
			background-color: #fff;
		}
		.headlabel{
			width: 12px;
			height: 18px;
			background-color: #1194d6;
			display: inline-block;
			vertical-align: middle;
			margin-right: 10px;
		}
		.layui-form-label{
			width:100px;
		}
		.layui-form-item .layui-input-inline.address{
			width:504px;
		}
		.tableResponse{
			height: 120px;
			overflow-y: auto;
		}
		.attachment{
			border: 1px solid #999;
			border-radius: 4px;
			width: 80px;
			display: inline-block;
		}
		.attachmentNumber{
			width:30px;
			border: none;
			outline: none;
		}
		.attachment span{
			padding: 0px 6px;
		}
		.layui-table[lay-skin=line] td{
			border-width: 1px;
		}
		#searchBrand,#searchEffect,#searchSpot{
			outline: none;
			border-radius: 8px;
			height: 27px;
			padding:4px 6px;
		}
		.brandContent{
			display: flex;
			flex-direction: row;
			flex-wrap: wrap
		}
		.brandLi{
			padding: 3px 10px;
			margin: 12px;
			border: 1px solid #ddd;
			height: 26px;
			background-color: #fff;
		}
		.colorLi{
			/*padding: 3px 10px;*/
			margin: 12px;
			border: 1px solid #ddd;
			height: 26px;
			width: 90px;

			display: flex;
			flex-direction: row;
			text-align: center;
			align-items: center;
			justify-content: center;
		}
		.brandLi-active{
			background-color: #aaa;
		}
		.brandOperation{
			display: none;
		}
		.colorOperation{
			display: none;
		}
		.spotOperation{
			display: none;
		}
		.effectOperation{
			display: none;
		}
		.colorLi_child{
			width: 45px;
			height: 26px;
		}
		.colorLi_child:first-of-type{
			text-align: right;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		.colorLi_child:last-of-type{
			text-align: left;
			display: flex;
			align-items: center;
			justify-content: center;
		}
		.shelfTitle{
			background-color: rgba(0,0,0,.3);
			color: #fff;
			text-align: center;
			overflow: hidden;
			margin-bottom: 15px;
		}
		.shelfTitle div{
			margin: 15px 0;
			font-size: 25px;
		}
		.flex1{
			flex:1;
		}
		.flex2{
			flex:2;
		}
		.flex3{
			flex:3;
		}
		.tit-msg{
			display: flex;
			justify-content: flex-end;
		}
		.tit-msg p{
			font-size:16px;
			margin-left:20px;
		}
		#table2 thead tr{
			background-color:#fff;
		}
		.list-message{
			display: flex;
			justify-content: flex-end;
		}
		.list-message .list-item{
			margin-left:25px;
		}
		#print2,#print3,#print4{
			display: none;
		}
		.layui-table[lay-skin=line] td, .layui-table[lay-skin=line] th{
			border: 1px solid #ccc;
		}
	</style>

</head>

<body>
		<form class="layui-form layui-row" style="float: left; " id="search1">
			<div class="layui-row">
				<div class="layui-inline  orderManage" style="margin-top:10px">
					<span class="headlabel"></span>包装确认
				</div>
			</div>
		</form>
		<!-- 下面是一些第二行的东西 -->
		<form class="layui-form">
			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label">条形码</label>
					<div class="layui-input-inline">
						<input type="text" id="barCode" placeholder="请输入衣物条码号" autocomplete="off" class="layui-input">
					</div>
				</div>
			    <div>
					<div class="layui-inline">
						<label class="layui-form-label">客户姓名</label>
						<div class="layui-input-inline">
							<input type="tel" id="name" readonly autocomplete="off" class="layui-input">
						</div>
					</div>
					<div class="layui-inline">
						<label class="layui-form-label">电话</label>
						<div class="layui-input-inline">
							<input type="tel" id="phone" readonly autocomplete="off" class="layui-input">
						</div>
					</div>
					<div class="layui-inline">
						<label class="layui-form-label">物流号</label>
						<div class="layui-input-inline">
							<input type="tel" id="wlNum" name="phone" lay-verify="required|phone" autocomplete="off" class="layui-input">
						</div>
					</div>
				</div>
				<div>
					<div class="layui-inline">
						<label class="layui-form-label">订单号</label>
						<div class="layui-input-inline">
							<input type="tel" id="orderNo" readonly autocomplete="off" class="layui-input">
						</div>
					</div>
					<div class="layui-inline">
						<label class="layui-form-label">衣物件数</label>
						<div class="layui-input-inline">
							<input type="tel" id="num" readonly autocomplete="off" class="layui-input">
						</div>
					</div>
					<div class="layui-inline" style="width: 500px;">
						<label class="layui-form-label">地址</label>
						<div class="layui-input-inline" style="width: calc(100% - 110px);">
							<input type="tel" id="address" readonly autocomplete="off" class="layui-input">
						</div>
					</div>
					<button type="button" class="layui-btn layui-btn-normal" id="print" style="float: right;">打印发货清单</button>
					<button type="button" class="layui-btn layui-btn-normal" id="print2" style="float: right;margin-right: 20px;">顺丰打印</button>
					<button type="button" class="layui-btn layui-btn-normal" id="print3" style="float: right;margin-right: 20px;">自配打印</button>
					<button type="button" class="layui-btn layui-btn-normal" id="print4" style="float: right;margin-right: 20px;">德邦打印</button>

				</div>
				<div class="layui-inline" style="display: flex;justify-content: flex-end;margin-right: 0;">
					<input style="width: 200px;" type="text" id="supplement" autocomplete="off" class="layui-input" placeholder="输入需要补打的订单号">
					<button type="button" class="layui-btn layui-btn-normal" id="suppBtn">补打订单</button>
				</div>
			  </div>

		</form>
		<!-- 下面是第三行表格 -->
		<table class="layui-table" lay-skin="line" align="center" id="table1">
			<thead>
				<tr align="center">
					<th width="200">条码号</th>
					<th>衣物名称</th>
					<th>颜色</th>
					<td>上架状态</td>
					<td>核对状态</td>
					<!--<td width="200">包装时间</td>-->
				</tr>
			</thead>
			<tbody></tbody>
		</table>
		<!-- 这个下面是分页 -->
		<div id="demo7"></div>
</body>
<div id="printPage" style="display: none;padding:15px;">
	<p style="font-size: 20px;text-align: center;font-weight: bold;">发货清单</p>
	<div class="tit-msg">
		<p>订单号：<span></span></p>
		<p>条形码：<span></span></p>
	</div>
	<table class="layui-table" lay-skin="line" align="center" id="table2">
		<thead>
			<tr>
				<td width="150px">客户姓名</td>
				<td class="td-name"></td>
				<td width="150px">客户电话</td>
				<td class="td-phone"></td>
				<td width="170px">订单号</td>
				<td class="td-orderNo"></td>
			</tr>
			<tr>
				<td width="150px">客户地址</td>
				<td colspan="3" class="td-address"></td>
				<td width="150px">衣物件数(不含附件数)</td>
				<td class="td-num"></td>
			</tr>
			<tr>
				<td>条码号</td>
				<td>衣物名称</td>
				<td>颜色</td>
				<td colspan="3">核对</td>
			</tr>
		</thead>
		<tbody></tbody>
	</table>
	<button class="layui-btn layui-btn-normal" style="float: right;margin-bottom:10px;" id="printOrder">打印</button>
</div>
<div id="fac-box" style="display:none;padding: 10px 20px 0 20px;">
	<div style="display: flex;">
		<div style="margin-right: 10px;">选择工厂</div>
		<select name="" id="factory" ></select>
	</div>
</div>
<div id="printOrder2" style="display: none;padding: 20px;">
    <p class="pTit">自配物流</p>
    <div class="pLine">
        <p class="pLeft">物流单号:<span id="pWlNo"></span></p>
    </div>
    <div class="pLine">
        <p class="pLeft">订单号:<span id="pOrderNo"></span></p>
    </div>
    <!--<div class="pLine">-->
        <!--<p class="pLeft">店铺名:<span id="pShop"></span></p>-->
    <!--</div>-->
    <div class="pLine">
        <p class="pLeft">收件人:<span id="pName"></span></p>
    </div>
    <div class="pLine">
        <p class="pLeft">联系方式:<span id="pTel"></span></p>
    </div>
    <div class="pLine">
        <p class="pLeft">送货地址:<span id="pAddress"></span></p>
    </div>
    <!--<div class="pLine">-->
        <!--<p class="pLeft">时间:<span id="pTime"></span></p>-->
    <!--</div>-->
    <br><br>
	<div class="pLine">
		<p class="pLeft">送件员:<span id="taker"></span></p>
	</div>
	<div class="pLine">
		<p class="pLeft">送件员电话:<span id="taker-phone"></span></p>
	</div>
    <div class="pLine">
        <p class="pLeft">工厂名:<span id="pShop2"></span></p>
    </div>
    <div style="width: 100px;height: 100px;margin: auto;">
        <img style="width: 100%; height: 100%;" id="printImg" src="" alt="">
    </div>
</div>
<div id="goodsList" style="display: none;padding: 10px;">
	<table class="layui-table">
		<thead>
			<tr>
				<th>名称</th>
				<th>颜色</th>
				<th>条码号</th>
				<th>状态</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>
	<div class="list-message">
		<p class="list-item list1">总计：<span></span></p>
		<p class="list-item list2">实发：<span></span></p>
		<p class="list-item list3">剩余：<span></span></p>
	</div>
</div>
<div id="printContext" class="ordercontent" style="display: none; margin-top: 15px; width: 630px; height: 665px; float: left; overflow-y: auto; text-align: center; display:none">
	<div id="expressPrintArea">
		<style>
			.wayBill li {
				float: left;
				width: 85px;
			}

			.wayBill li a:hover {
				color: blue;
			}

			.wayBill li a {
				color: blue;
			}
			#expressPrintArea {
				width: 100mm;
				height: 180mm;
				margin-left: 100px;
				/*  float: left; */
				/* background: url('../images/order/lttBackground.jpg') no-repeat; */
				background-size: 104mm 175mm;
				padding: 4mm 0.5mm 0.5mm 2.3mm;
			}
			td {
				border: 0.15mm solid #cecece;
				padding-left: 1mm;
				font-size: 12px;
				font-family: 宋体;
				vertical-align: middle;
				text-align: left;
			}
			tr {
				width: 100%;
				border-left:0mm;
				border-right:0mm;
				border: 0.2mm solid #000000;
			}
			.singlePlane{
				font-size: 7pt;
				width:60mm;
				font-family:黑体;
				text-align:left;
				valign:top;
			}
			.sign{
				font-size:8pt;
				width:60mm;
				font-family:黑体;
				text-align:right;
				line-height: 5mm;
				padding-top: 2mm;
			}
			.singlePlane2{
				font-size:7pt;
				width:99mm;
				font-family:黑体;
				text-align:left;
				valign:top;
				padding-left: 1mm;
				padding-right: 1mm;
			}
			.houseCode td{
				font-size:17px;width:20mm;font-family:黑体; font-weight:bold; text-align:center;
			}
			.originalNumber {
				font-size: 15px;
				font-weight: bold;
			}

			#cargoName {
				font-size:  16px;
				font-weight: bold;
			}
			#transNote {
				font-weight: bold;
			}
			#transNote {
				font-size:  10px;
			}

			.top-amount td span, .top-amount td strong, .outerField1, .signSheet {
				font-size: 10px !important;
				font-family: "黑体";
			}

		</style>
		<%-- <div style="width: 20mm;height: 20mm;/* background-color: #fff; */text-align: center;line-height: 20mm;position: absolute; left:50mm; top:60mm;">
		<span class="markerPenCode" style=" display: inline-block; color: #666;font-size: 40mm;font-weight: bold;transform:rotate(-30deg);opacity: 0.5;">A5</span>
	</div> --%>
		<span class="markerPenCode" style="
        /*display: none;*/
"></span>
		<table border="2" style="width: 99mm;border-collapse:collapse;">
			<%--==================================上联=============================================--%>
			<tr class="tr1" style="height: 0mm; border: none;">
				<td width="10mm"></td>
				<td width="10mm"></td>
				<td width="10mm"></td>
				<td width="10mm"></td>
				<td width="10mm"></td>
				<td width="10mm"></td>
				<td width="10mm"></td>
				<td width="10mm"></td>
				<td width="10mm"></td>
				<td width="5mm"></td>
			</tr>
			<%--德邦--%>
			<tr style="height: 14mm;">
				<td colspan="3"></td>
				<td valign="middle" colspan="3" style="border-top:0mm;background:white;color:black;line-height:72px;font-weight:bold; text-align:center; font-size:20px;" id="refundPaymentId">11</td>
				<td valign="middle" colspan="2" style="border-top:0mm;background:white;color:white;line-height:72px;font-weight:bold; text-align:center; font-size:50px;" id="payTypeId">22</td>
				<td valign="middle" colspan="2" style="border-top:0mm;background:white;color:black;line-height:72px;font-weight:bold; text-align:left; font-size:50px;" id = "transTypeId">
					<span class=transType></span></td>
			</tr>
			<%--金额--%>
			<tr style="height: 11mm;" class="top-amount">
				<td colspan="4" style="width: 30mm; vertical-align: middle; border-right: 0px;">
					<span style="padding-bottom: 1.5mm;"><strong>代收金额：</strong></span><span
						class="refundPayment"></span><br/>
				</td>
				<td colspan="6" style="width: 50mm; vertical-align: middle; border-left: 0px;">
					<span style="padding-bottom: 1.5mm;"><strong>保价金额：</strong></span><span
						class="insuranceMoney"></span><br/>
					<span style="padding-bottom: 1.5mm;"><strong>签单返回：</strong></span><span
						class="signSheet"></span><br/>
					<span style="padding-bottom: 1.5mm;"><strong>始发网点：</strong></span><span
						class="outerField1" style="font-size: 8px;"></span><br/>
				</td>
			</tr>
			<%--大头笔--%>
			<tr style="height: 14mm;" >
				<td colspan="10" style="text-align: center; line-height: 13mm; vertical-align: middle;font-size: 35px; font-weight: bold; margin: 0px; padding: 0px;" id="markerPen">
					无大头笔信息
				</td>
			</tr>

			<%--收件人--%>
			<tr style="height: 14mm;">
				<td  colspan="1"style="font-weight:bold;border-right:0mm;font-family:黑体;font-size:25px;width:10mm;text-align:center;">收</td>
				<td colspan="9"
					style="border-right:0mm;font-size:10pt;width:90mm;font-family:黑体;font-weight:bold;text-align:left; " id="conMsg">
					<span class="conName">张小二</span>&nbsp;&nbsp;
					<span class="conPhone">（优先取手机号取不到取固话）</span>&nbsp;&nbsp;&nbsp;<span class="conTel"></span><br/>
					<span class="caddress">上海市青浦区徐泾镇明珠路10181号</span>
				</td>
			</tr>
			<%--寄件人--%>
			<tr style="height: 11mm;">
				<td colspan="1" style="border-right:0mm;font-size:25px;width:10mm;font-family:黑体;font-weight:bold;text-align:center;">
					寄
				</td>
				<td colspan="9" style="font-family:黑体;text-align:left; font-size:10px;font-weight:bold">
					<span class="shipperName"></span>&nbsp;&nbsp;&nbsp;
					<span class="shipperPhone"></span><br/>
					<span class="saddress">寄件人地址</span>
				</td>
			</tr>
			<%--运单号条码--%>
			<tr style="height: 23mm;">
				<td colspan="10"></td>
			</tr>
			<%--打印时间验视--%>
			<tr style="height: 18mm; text-align: left;">
				<td colspan="2" valign="bottom" colspan="2" style="text-align:left;font-size:12px;font-family:黑体;width:20mm;border-right:0mm;">
                    <span class="printTime">
                    </span><br/>
				</td>
				<td colspan="6">
					<div class = "singlePlane">
						快件送达收件人地址，经收件人或收件人（寄件人）允许的代收人签字，视为送达。您的签字代表您已经签收次包裹，并已确定商品信息无损，包装完好、没有划痕、破损等表面质量问题。
						<br/>
					</div>
					<div class="sign">
						签收栏
					</div>
				</td>
				<td valign="bottom" colspan="2" style="text-align:center;font-size:12px;width:20mm;font-family:黑体;border-right:0mm;">已验视</td>
			</tr>
			<%--==================================下联=============================================--%>
			<%--德邦图标--%>
			<tr style="height: 12mm;" >
				<td colspan="4" align="center"></td>
				<td colspan="6" align="center">
				</td>
			</tr>
			<%--收件人--%>
			<tr style="height: 10mm;">
				<td  colspan="1"style="font-weight:bold;border-right:0mm;font-family:黑体;font-size:25px;width:10mm;text-align:center;">收</td>
				<td  colspan="7"style="font-family:黑体;text-align:left; font-size:10px;font-weight:bold;" id="conMsg2">
					<span class="conName"></span>&nbsp;&nbsp;
					<span class="conPhone"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<span class="conTel"></span><br/><span class="caddress"></span></td>
				<%--<td  rowspan="2" valign="bottom">  <!-- <img src="../images/order/deppon_qrcode.jpg" /> --> </td>--%>
				<td valign="bottom" rowspan="2" style="width:180mm;border-right:0mm;">
					<img src="qrCode.jpg" style="width: 18mm; height: 18mm" />
				</td>
			</tr>
			<%--寄件人--%>
			<tr style="height: 10mm;">
				<td  colspan="1"style="font-weight:bold;border-right:0mm;font-family:黑体;font-size:14pt;width:10mm;text-align:center;">寄</td>
				<td  colspan="7"style="font-family:黑体;text-align:left; font-size:10px;font-weight:bold">
					<span class="shipperName"></span>&nbsp;&nbsp;&nbsp;
					<span class="shipperPhone"></span><br/>
					<span class="saddress"></span>
			</tr>
			<tr style="text-align: left;">
				<td colspan="10">
					<div class="singlePlane2" style="height: 5mm; max-height: 5mm;">
						客户订单号：<span class="originalNumber"></span>
					</div>
					<div class="singlePlane2" style="height: 10mm; max-height: 10mm;">
						货物品名:<span id="cargoName" class="cargoName"></span>
					</div>
					<div class="singlePlane2" style="height: 11mm; max-height: 11mm;">
						备注：<span class="transNote" id="transNote"></span>
					</div>
				</td>
			</tr>
		</table>
	</div>
</div>
<script src='./js/jquery.min.js'></script>
<script type="text/javascript" src="../resource/layui/layui.js"></script>
<script src="../resource/js/common.js"></script>
<script src="../resource/js/jquery.cookie.js"></script>
<script src="js/jquery.jqprint-0.3.js"></script>
<script src="js/print.js"></script>
<script src="js/jquery.PrintArea.js"></script>
<script language="javascript" src="js/LodopFuncs.js"></script>
<script src="js/myAlert.js"></script>
<script src="js/myPrintKit.js"></script>
<object  id="LODOP_OB" classid="clsid:2105C259-1E0C-4534-8141-A753534CB4CA" width=0 height=0>
<embed id="LODOP_EM" type="application/x-print-lodop" width=0 height=0></embed>
</object>
<script type="text/javascript">
	var orderNo="";
	var codeNo="";
	var page=1;
	var pageSize=8;
	layui.use(['element', 'form', 'layer','table', 'laydate', 'laypage','colorpicker'], function () {
		var element = layui.element;
		var laydate = layui.laydate;
		var laypage = layui.laypage
			,table = layui.table
			,colorpicker = layui.colorpicker
			, layer = layui.layer;

		var $ = layui.jquery, layer = layui.layer; //独立版的layer无需执行这一句

        laydate.render({
            elem: '#searchDate1',
            type: 'date'
        });

        $("#barCode").val("").focus();
        getShopList();
	});

    //  扫码
    var excute = true;
    $("#barCode").bind("input propertychange", function () {
        var codeNum = $("#barCode").val();
        if (codeNum.length == 16 && excute) {
//            animate=layer.load();
            excute = getOrderMsg(codeNum);
        } else {
            excute = true;
        }
        return true
    });

    $("#print").click(function(){
		if($("#table1 tbody").html()==""&&$("#supplement").val()==""){
		    layer.msg("请录入订单信息");
			return false
		}
		if($("#table1 tbody").html()!=""&&$("#supplement").val()==""){
            for(var i=0;i<$("#table1 tbody tr").length;i++){
                if($("#table1 tbody tr").eq(i).find($(".check")).html()=='未核对'){
                    layer.msg('请核对完所有商品才能打印清单');
                    return false;
                }
            }
		}
		if($("#table1 tbody").html()==""&&$("#supplement").val()!=""){
		    orderNo=$("#supplement").val();
		}

		layer.confirm('请先打印物流单，确保发货清单准确无误',{btn:['已打印','未打印']},function(){
		    layer.closeAll();
            getLists(orderNo);
		});
	});

    $("#printOrder").click(function(){
//        $("#printPage").jqprint();
		$.ajax({
            url: globalUrl + "api/deliver/printCode;jsessionid=" + $.cookie("token"),
            type: 'post',
            data: {orderNo:orderNo},
            crossDomain: true,
            beforeSend: function (request) {
                request.setRequestHeader("JSESSIONID", $.cookie("token"));
            },
			success:function(data){
                console.log(data);
//                printOrder([data.data]);
			}
		})
	});

    $("#print2").click(function(){
        if(!$("#orderNo").val()){
            layer.msg('请录入订单');
            return;
		}
        if(!checkPrint()){
            return;
        }
		layui.use('layer',function(){
		   	var layer=layui.layer;
		   	layer.open({
				title:'选择工厂',
				type:1,
				content:$("#fac-box"),
				btn:['打印','取消'],
				yes:function(){
				    var facId=$("#factory option:checked").attr("shopId");
					$.ajax({
                        url: globalUrl + "api/deliver/printCode;jsessionid=" + $.cookie("token"),
                        type: 'post',
                        data: {orderNo:orderNo,factoryId:facId,type:1},
                        crossDomain: true,
                        beforeSend: function (request) {
                            request.setRequestHeader("JSESSIONID", $.cookie("token"));
                        },
                        success:function(data){
							if(data.status==200){
                                layer.closeAll();
                                printOrder([data.data]);
							}else{
							    layer.msg(data.msg);
							}
                        }
					})
				}
			})
		});
	});
    $("#print3").click(function(){
        if(!$("#orderNo").val()){
            layer.msg('请录入订单');
            return;
        }
        if(!checkPrint()){
            return;
        }
        layui.use('layer',function(){
            var layer=layui.layer;
            var choseFac=layer.open({
                title:'选择工厂',
                type:1,
                content:$("#fac-box"),
                btn:['打印','取消'],
                yes:function(){
                    layer.close(choseFac);
                    layer.load();
                    var facId=$("#factory option:checked").attr("shopId");
                    $.ajax({
                        url: globalUrl + "api/deliver/printCode;jsessionid=" + $.cookie("token"),
                        type: 'post',
                        data: {orderNo:orderNo,factoryId:facId,type:2},
                        crossDomain: true,
                        beforeSend: function (request) {
                            request.setRequestHeader("JSESSIONID", $.cookie("token"));
                        },
                        success:function(data){
                            layer.closeAll();
                            if(data.status==200){
                                var shopName=data.data.address.shopName?data.data.address.shopName:'';
                                if(!shopName){
                                    $(".pLine").eq(2).hide();
                                }
                                var userName="";
                                if(data.data.address.userName){
                                    userName=data.data.address.userName;
                                }
                                if(data.data.address.consumerName){
                                    userName=data.data.address.consumerName;
                                }
                                var tel1=data.data.address.tel?data.data.address.tel:data.data.address.phone;
                                var time1=data.data.address.startTime?timestampToTime(data.data.address.startTime):"";
                                var dAddress1=data.data.address.shopAddress?data.data.address.shopAddress:data.data.address.detailAddress;
//                                var address2=data.data.shopManager.shopAddress?
                                $("#pWlNo").html(data.data.codeNo);
                                $("#wlNum").val(data.data.codeNo);
                                $("#pOrderNo").html(data.data.orderNo);
                                $("#pShop").html(shopName);
                                $("#pName").html(userName);
                                $("#pTel").html(tel1);
                                $("#pAddress").html(data.data.address.region+"-"+dAddress1);
                                $("#pTime").html(time1);
								if(data.data.taker){
                                    $("#taker").html(data.data.taker.takerName);
                                    $("#taker-phone").html(data.data.taker.phone);
								}
                                $("#pShop2").html(data.data.shopManager.shopName);
                                $("#printImg").attr("src","http://"+data.data.codePic);
                                layer.open({
                                    title:'自配订单',
                                    type:1,
                                    content:$("#printOrder2"),
									btn:['打印'],
									yes:function(){
                                        $("#printOrder2").jqprint();
									}
                                });
                            }else{
                                layer.msg(data.msg);
							}
                        },error:function(){
                            layer.closeAll();
						}
                    })
                }
            })
        });
    });

    $("#print4").click(function(){
        if(!$("#orderNo").val()){
            layer.msg('请录入订单');
            return;
        }
        if(!checkPrint()){
            return;
        }
        layui.use('layer',function(){
            var layer=layui.layer;
            layer.open({
                title:'选择工厂',
                type:1,
                content:$("#fac-box"),
                btn:['打印','取消'],
                yes:function(){
                    var facId=$("#factory option:checked").attr("shopId");
                    $.ajax({
                        url: globalUrl + "api/deliver/printCode;jsessionid=" + $.cookie("token"),
                        type: 'post',
                        data: {orderNo:orderNo,factoryId:facId,type:3},
                        crossDomain: true,
                        beforeSend: function (request) {
                            request.setRequestHeader("JSESSIONID", $.cookie("token"));
                        },
                        success:function(data){
                            if(data.status==200){
                                layer.closeAll();
                                printTest(data);
                            }else{
                                layer.msg(data.msg);
                            }
                        }
                    })
                }
            })
        });
    });

    $("#suppBtn").click(function(){
       	var orderNo=$("#supplement").val();
        $.ajax({
            url: globalUrl + "api/deliver/repeatPrint;jsessionid=" + $.cookie("token"),
            type: 'get',
            data: {orderNo:orderNo},
            crossDomain: true,
            beforeSend: function (request) {
                request.setRequestHeader("JSESSIONID", $.cookie("token"));
            },
            success:function(data){
                if(data.status==200){
                    if(data.data.type==1){
                        printOrder([data.data]);
					}else if(data.data.type==2){
                        var shopName=data.data.address.shopName?data.data.address.shopName:'';
                        if(!shopName){
                            $(".pLine").eq(2).hide();
                        }
                        var userName="";
                        if(data.data.address.userName){
                            userName=data.data.address.userName;
                        }
                        if(data.data.address.consumerName){
                            userName=data.data.address.consumerName;
                        }
                        var tel1=data.data.address.tel?data.data.address.tel:data.data.address.phone;
                        var time1=data.data.address.startTime?timestampToTime(data.data.address.startTime):"";
                        var dAddress1=data.data.address.shopAddress?data.data.address.shopAddress:data.data.address.detailAddress;
                        $("#pWlNo").html(data.data.codeNo);
                        $("#wlNum").val(data.data.codeNo);
                        $("#pOrderNo").html(data.data.orderNo);
                        $("#pShop").html(shopName);
                        $("#pName").html(userName);
                        $("#pTel").html(tel1);
                        $("#pAddress").html(data.data.address.region+"-"+dAddress1);
						if(data.data.taker){
                            $("#taker").html(data.data.taker.takerName);
                            $("#taker-phone").html(data.data.taker.phone);
						}

                        $("#pShop2").html(data.data.shopManager.shopName);
                        $("#printImg").attr("src","http://"+data.data.codePic);
                        layer.open({
                            title:'自配订单',
                            type:1,
                            content:$("#printOrder2"),
                            btn:['打印'],
                            yes:function(){
                                $("#printOrder2").jqprint();
                                layer.closeAll();
                            }
                        });
					}else if(data.data.type==3){
                        printTest(data);
					}
                }else{
                    layer.msg(data.msg);
				}
            }
        })
	});

    function getOrderMsg(code){
        $.ajax({
            url: globalUrl + "api/deliver/packScan;jsessionid=" + $.cookie("token"),
            type: 'get',
            data: {barCode:code},
            crossDomain: true,
            beforeSend: function (request) {
                request.setRequestHeader("JSESSIONID", $.cookie("token"));
            },
			success:function(data){
				if(data.status==200){
				    orderNo=data.data.washItems[0].orderNo;
				    codeNo=code;
					$("#name").val(data.data.address.userName?data.data.address.userName:data.data.address.shopName);
					$("#phone").val(data.data.address.phone?data.data.address.phone:data.data.address.tel);
					$("#orderNo").val(data.data.washItems[0].orderNo);
					$("#num").val(data.data.num);
					var dAddress=data.data.address.shopAddress?data.data.address.shopAddress:data.data.address.detailAddress;
					var address=data.data.address.region+"-"+dAddress;
					$("#address").val(address);
					$("#table1 tbody").html("");
					for(var i=0;i<data.data.washItems.length;i++){
                        var colour=data.data.washItems[i].colour?data.data.washItems[i].colour:'';
					    var tab=data.data.washItems[i].tab?'<b style="color:green;">已核对</b>':'<b style="color:red;">未核对</b>';
//					    var time=data.data.washItems[i].updateTime?timestampToTime(data.data.washItems[i].updateTime):"";
						var item='<tr>' +
							'<td>'+data.data.washItems[i].barCode+'</td>' +
							'<td>'+data.data.washItems[i].beforeName+'</td>' +
                            '<td>'+colour+'</td>' +
                            '<td>已上架</td>' +
                            '<td class="check">'+tab+'</td>' +
//                            '<td>'+time+'</td>'+
							'</tr>';
						$(item).appendTo($("#table1 tbody"));
					}
					if(data.data.expressStatus==1||data.data.expressStatus==3){
					    $("#print2").show();
                        $("#print4").show();
					}else if(data.data.expressStatus==2){
                        $("#print3").show();
					}
				}else{
				    layer.msg(data.msg);
				}
                $("#barCode").val("").focus();
			}
		})
	}

    function getShopList() {
        $.ajax({
            type: "get",
            url: globalUrl + "api/deliver/factoryList;jsessionid=" + $.cookie("token"),
            data: {factoryStatus:0},
            crossDomain: true,
            beforeSend: function (request) {
                request.setRequestHeader("JSESSIONID", $.cookie("token"));
            },
            success: function (data) {
				if(data.status==200){
				    $("#factory").html("");
				    for(var i=0;i<data.data.length;i++){
				        var item='<option shopId="'+data.data[i].id+'">'+data.data[i].shopName+'</option>';
				        $(item).appendTo($("#factory"));
					}
				}
            }
        })
    }

    function checkPrint(){
        var go=true;
        for(var i=0;i<$("#table1 tbody tr").length;i++){
            if($("#table1 tbody tr").eq(i).find($(".check b")).html()=='未核对'){
                go=false;
                layer.msg('还有商品未审核');
			}
		}
        return go;
	}

	function getLists(orderNo){
        $.ajax({
            type: "get",
			async:false,
            url: globalUrl + "api/deliver/printBill;jsessionid=" + $.cookie("token"),
            data: {orderNo:orderNo},
            crossDomain: true,
            beforeSend: function (request) {
                request.setRequestHeader("JSESSIONID", $.cookie("token"));
            },
            success: function (data) {
				if(data.status==200){

                    $("#goodsList .list-message .list1 span").html(data.data.total);
                    $("#goodsList .list-message .list2 span").html(data.data.num);
                    $("#goodsList .list-message .list3 span").html(data.data.surplus);
				    $("#goodsList table tbody").html("");
				    for(var i=0;i<data.data.washItems.length;i++){
				        var colour=data.data.washItems[i].colour?data.data.washItems[i].colour:'';
				        var send=data.data.washItems[i].sendUser==1?'<p style="color:green;">已发货</p>':'<p style="color:red;">未发货</p>';
				        var item='<tr goodsId="'+data.data.washItems[i].id+'">' +
							'<td>'+data.data.washItems[i].beforeName+'</td>' +
							'<td>'+colour+'</td>' +
							'<td>'+data.data.washItems[i].barCode+'</td>' +
							'<td>'+send+'</td>' +
							'</tr>';
				        $(item).appendTo($("#goodsList table tbody"));
					}
					layui.use('layer',function(){
					    var layer=layui.layer;
					    layer.open({
							title:'发货清单',
							type:1,
							area:['600px','400px'],
							content:$("#goodsList"),
							btn:['打印','取消'],
							yes:function(){
                                $("#goodsList").jqprint();
							}
						})
					})
				}
            }
        })
	}


</script>
</html>